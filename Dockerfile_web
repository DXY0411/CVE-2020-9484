FROM tomcat:9.0.1-jre8

ADD ./context.xml /usr/local/tomcat/conf/context.xml
ADD ./server.xml /usr/local/tomcat/conf/server.xml
ADD ./groovy-2.3.9.jar /usr/local/tomcat/lib/groovy-2.3.9.jar
COPY ./wait-for-it.sh /usr/local/tomcat/webapps/wait-for-it.sh

WORKDIR /usr/local/tomcat/webapps
RUN rm -rf ROOT docs examples host-manager manager
COPY ./whoknows-0.7.0 ROOT
RUN chmod 755 wait-for-it.sh

EXPOSE 8080
CMD bash -c "./wait-for-it.sh db:3306 -- echo 1 && /usr/local/tomcat/bin/catalina.sh run"